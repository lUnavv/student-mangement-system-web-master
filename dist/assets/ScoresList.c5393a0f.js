import{J as de,e as x,a0 as pe,i as me,a9 as _e,o as g,Q as C,R as o,ag as n,a as p,X as t,V as D,c as S,a6 as R,F as N,u as y,G as L,a7 as j,S as fe,W as F,aj as ge,ax as De,ay as ye}from"./@vue.6f39e54a.js";import{g as ve}from"./student.7481401c.js";import{g as Ee}from"./teacher.aa7b0f15.js";import{s as A}from"./request.f1f11a88.js";import{f as Fe}from"./date.0d8a53f8.js";import{e as be}from"./exprotExcel.37bf0302.js";import{a as c}from"./element-plus.1daafd39.js";import{_ as xe}from"./index.9ba80206.js";import"./axios.754b77ca.js";import"./form-data.2b153385.js";import"./exceljs.8ca1ad7e.js";import"./dayjs.ca59b222.js";import"./lodash-es.a286bec7.js";import"./@vueuse.017cd7ad.js";import"./@element-plus.32f59e87.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.43a1fe53.js";import"./vue-router.f9fbd5dd.js";import"./nprogress.dd199a36.js";import"./pinia.ca2353a2.js";import"./pinia-plugin-persistedstate.0afbc90b.js";function Be(s){return A({url:"scores",method:"get",params:s})}function he(s,r){return A({url:"scores",method:"post",data:{gradeClassId:s,courseId:r}})}function we(s,r){return A({url:"scores",method:"put",data:{id:s,score:r}})}function Ce(s){return A({url:`scores/${s}`,method:"delete"})}const Se=s=>(De("data-v-c5f9edcc"),s=s(),ye(),s),Ae={class:"card-header"},Ve={class:"card-search"},ke={class:"table-box"},ze=Se(()=>p("span",null," \u6210\u7EE9 ",-1)),Ie={key:0,class:"edit-score"},Le={key:1},Me={class:"highlight"},Ue=de({__name:"ScoresList",setup(s){const r=x(null),M=x([]);async function O(){try{const{data:e}=await ve();e.status===200&&(M.value=e.result)}catch(e){console.log(e)}}const v=x(null),U=x([]);async function W(){try{const{data:e}=await Ee();e.status===200&&(U.value=e.result)}catch(e){console.log(e)}}const u=pe({stuno:"",name:"",tableData:[],total:0,pageSize:10,pageIndex:1,loading:!1}),m=async e=>{e.loading=!0,e.tableData=[];const l={pageIndex:e.pageIndex,pageSize:e.pageSize,name:e.name,stuno:e.stuno,courseId:v.value,gradeClassId:r.value},{data:i}=await Be(l);e.tableData=i.content,e.total=i.totalElements,e.loading=!1},G=e=>{const l=u.pageIndex,i=u.pageSize;return e+1+(l-1)*i},J=()=>{u.name="",u.stuno="",v.value="",r.value="",m(u)},T=()=>{u.name!==null&&u.name!==""&&(c({type:"success",message:`\u5B66\u751F\u59D3\u540D\u201C${u.name}\u201D\u641C\u7D22\u5185\u5BB9\u5982\u4E0B`}),m(u)),u.stuno!==null&&u.stuno!==""&&(c({type:"success",message:`\u5B66\u53F7\u201C${u.stuno}\u201D\u641C\u7D22\u5185\u5BB9\u5982\u4E0B`}),m(u))},P=e=>{u.pageIndex=e,m(u)},Q=async()=>{if(r.value<1)return c.success("\u8BF7\u9009\u62E9\u73ED\u7EA7"),console.log("gradeClassId.value:",r.value),!1;if(v.value<1)return c.success("\u8BF7\u9009\u62E9\u5B66\u79D1"),!1;const{data:e}=await he(r.value,v.value);e.status===200?(await m(u),c.success(e.message)):c.error(e.message)};x(!1);const X=(e,l,i,d)=>{const _=u.tableData.find(h=>h.id===e.id);_!==void 0&&(_._originalData={..._},_.edit=!_.edit)},q=e=>{e._originalData={...e},e.edit=!e.edit},H=async e=>{B.value=!0;const{id:l,score:i}=e;if(!i){B.value=!1,c.error("\u63D0\u4EA4\u5931\u8D25\uFF0C\u8BF7\u66F4\u6539\u6210\u7EE9\uFF01");return}const{data:d}=await we(l,i);d.status===200?(c.success(d.message),await m(u)):c.error(d.message),B.value=!1},Y=async e=>{const{data:l}=await Ce(e);l.status===200?(c.success("\u5220\u9664\u6210\u529F"),await m(u)):c.error("\u5220\u9664\u5931\u8D25")},Z=[{name:"id",label:"\u6210\u7EE9id"},{name:"stuno",label:"\u5B66\u53F7"},{name:"name",label:"\u5B66\u751F\u59D3\u540D"},{name:"coursename",label:"\u5B66\u79D1"},{name:"score",label:"\u6210\u7EE9"},{name:"type",label:"\u7C7B\u578B"}],ee=()=>{const e=u.tableData.flatMap(l=>({...l,...l.course,...l.student}));be({column:Z,data:e,filename:"\u73ED\u7EA7\u5B66\u79D1\u6210\u7EE9\u6570\u636E",format:"xlsx",autoWidth:!0})};me(()=>{m(u),W(),O()});const{tableData:te,pageIndex:Te,pageSize:V,loading:B,total:ae,name:k,stuno:z}=_e(u);return(e,l)=>{const i=n("Money"),d=n("el-icon"),_=n("el-option"),h=n("el-select"),E=n("el-col"),b=n("el-button"),oe=n("Download"),I=n("el-input"),le=n("Refresh"),ue=n("el-row"),f=n("el-table-column"),$=n("Edit"),K=n("el-tooltip"),ne=n("el-popconfirm"),se=n("el-table"),re=n("el-pagination"),ce=n("el-card"),ie=ge("loading");return g(),C(ce,{class:"box-card"},{header:o(()=>[p("div",Ae,[p("h3",null,[t(d,{style:{"margin-right":"10px"}},{default:o(()=>[t(i)]),_:1}),D("\u6210\u7EE9\u8BE6\u60C5 ")]),p("div",Ve,[t(ue,{gutter:12},{default:o(()=>[t(E,{span:5},{default:o(()=>[t(h,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=a=>r.value=a),placeholder:"\u8BF7\u9009\u62E9\u73ED\u7EA7",style:{width:"100%"}},{default:o(()=>[(g(!0),S(N,null,R(M.value,a=>(g(),C(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,{span:5},{default:o(()=>[t(h,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),placeholder:"\u8BF7\u9009\u62E9\u79D1\u76EE",style:{width:"100%"}},{default:o(()=>[(g(!0),S(N,null,R(U.value,a=>(g(),C(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(E,{span:6},{default:o(()=>[t(b,{plain:"",color:"#2fa7b9",onClick:Q},{default:o(()=>[D("\u767B\u8BB0\u6210\u7EE9")]),_:1}),t(b,{plain:"",onClick:ee,type:"primary"},{default:o(()=>[t(d,{style:{"margin-right":"1px"}},{default:o(()=>[t(oe)]),_:1}),D("\u5BFC\u51FA Excel ")]),_:1})]),_:1}),t(E,{span:3},{default:o(()=>[t(I,{"prefix-icon":e.Search,modelValue:y(z),"onUpdate:modelValue":l[2]||(l[2]=a=>L(z)?z.value=a:null),onKeyup:j(T,["enter","native"]),placeholder:"\u5B66\u53F7\u641C\u7D22\uFF08\u56DE\u8F66\uFF09"},null,8,["prefix-icon","modelValue","onKeyup"])]),_:1}),t(E,{span:3},{default:o(()=>[t(I,{"prefix-icon":e.Search,modelValue:y(k),"onUpdate:modelValue":l[3]||(l[3]=a=>L(k)?k.value=a:null),onKeyup:j(T,["enter","native"]),placeholder:"\u59D3\u540D\u641C\u7D22\uFF08\u56DE\u8F66\uFF09"},null,8,["prefix-icon","modelValue","onKeyup"])]),_:1}),t(E,{span:2,style:{display:"inline-flex","justify-content":"center","align-items":"center",cursor:"pointer"}},{default:o(()=>[t(d,{style:{"font-size":"20px",color:"#b3b6bc"},onClick:J},{default:o(()=>[t(le)]),_:1})]),_:1})]),_:1})])])]),default:o(()=>[p("div",ke,[fe((g(),C(se,{"row-key":"id","element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D...",data:y(te),style:{width:"100%","text-align":"center"},"cell-style":{textAlign:"center"},"header-cell-style":{fontSize:"15px",background:"#80adff",color:"white",textAlign:"center"},onCellDblclick:X},{default:o(()=>[t(f,{label:"\u5E8F\u53F7",width:"100",type:"index",index:G}),t(f,{label:"\u5B66\u53F7",prop:"student.stuno"},{default:o(a=>[p("span",null,F(a.row.student.stuno),1)]),_:1}),t(f,{label:"\u5B66\u751F\u59D3\u540D",prop:"name"},{default:o(a=>[p("span",null,F(a.row.student.name),1)]),_:1}),t(f,{prop:"coursename",label:"\u5B66\u79D1"},{default:o(a=>[p("span",null,F(a.row.course.coursename),1)]),_:1}),t(f,null,{header:o(()=>[ze,t(d,null,{default:o(()=>[t($)]),_:1})]),default:o(a=>[a.row.edit?(g(),S("div",Ie,[t(I,{clearable:"",placeholder:"\u8BF7\u8F93\u5165",modelValue:a.row.score,"onUpdate:modelValue":w=>a.row.score=w},null,8,["modelValue","onUpdate:modelValue"]),t(b,{type:"success",size:"small",onClick:w=>H(a.row),style:{margin:"0 0 10px 10px"}},{default:o(()=>[D("\u4FDD\u5B58")]),_:2},1032,["onClick"]),t(b,{type:"warning",size:"small",onClick:w=>q(a.row),style:{margin:"0 0 10px 10px"}},{default:o(()=>[D("\u53D6\u6D88")]),_:2},1032,["onClick"])])):(g(),S("span",Le,[D(F(a.row.score)+" ",1),t(K,{content:"\u53CC\u51FB\u7F16\u8F91",placement:"top",effect:"light"},{default:o(()=>[t(d,{style:{cursor:"pointer"}},{default:o(()=>[t($)]),_:1})]),_:1})]))]),_:1}),t(f,{label:"\u7C7B\u578B",prop:"type"},{default:o(a=>[p("span",null,F(a.row.type),1)]),_:1}),t(f,{label:"\u521B\u5EFA\u65F6\u95F4"},{default:o(a=>[t(K,{content:a.row.createTime,placement:"top",effect:"light"},{default:o(()=>[p("span",Me,F(y(Fe)(a.row.createTime,"yyyy-MM-dd")),1)]),_:2},1032,["content"])]),_:1}),t(f,{label:"\u64CD\u4F5C"},{default:o(a=>[t(ne,{"confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",icon:e.Delete,"icon-color":"#626AEF",title:"\u786E\u5B9A\u5220\u9664\u5B66\u751F\u540D\u4E3A\u201C"+a.row.student.name+"\u201D\u7684\u6210\u7EE9\u5417\uFF1F",onConfirm:w=>Y(a.row.id)},{reference:o(()=>[t(b,{size:"small",type:"danger",style:{"margin-bottom":"10px"}},{default:o(()=>[D("\u5220\u9664")]),_:1})]),_:2},1032,["icon","title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[ie,y(B)]])]),t(re,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:y(ae),"page-size":y(V),"onUpdate:page-size":l[4]||(l[4]=a=>L(V)?V.value=a:null),onCurrentChange:P,"page-sizes":[10,20,30,40]},null,8,["total","page-size"])]),_:1})}}});const it=xe(Ue,[["__scopeId","data-v-c5f9edcc"]]);export{it as default};
